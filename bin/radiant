#!/usr/bin/env sh

NOW_PLAYING=$(osascript <<EOF
  if app_is_running("Radiant Player") then
    tell application "Radiant Player"
      set artist to current song artist
      set track to current song name
      set state to player state

      -- FIXME: temporarily displaying track info anyway
      return "#[fg=red] ♫ " & track & " - " & artist & "#[fg=default]"

      if state is 1 then
        -- paused
        return "#[fg=colour240] ♫ - paused #[fg=default]"
      else if state is 2 then
        -- playing
        return "#[fg=red] ♫ " & track & " - " & artist & "#[fg=default]"
      else if state is 0 then
        -- stopped
        return ""
      end if
    end tell
  end if

  on app_is_running(app_name)
    tell app "System Events" to (name of processes) contains app_name
  end app_is_running
EOF)

echo $NOW_PLAYING
